<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password - ReadNest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap");

      * {
        font-family: "Poppins", sans-serif;
      }
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .form-container {
        animation: slideIn 0.5s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .input-field {
        transition: all 0.3s ease;
      }
      .input-field:focus {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .submit-btn {
        transition: all 0.3s ease;
      }
      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(79, 70, 229, 0.4);
      }
      .password-toggle {
        cursor: pointer;
        transition: color 0.2s ease;
      }
      .password-toggle:hover {
        color: #667eea;
      }
      .error-message {
        display: none;
        animation: shake 0.3s ease;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }
      .success-message {
        display: none;
        animation: fadeIn 0.3s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .icon-container {
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
      .strength-meter {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
        margin-top: 8px;
      }
      .strength-bar {
        height: 100%;
        width: 0%;
        transition: all 0.3s ease;
      }
      .strength-weak {
        background: #ef4444;
        width: 33%;
      }
      .strength-medium {
        background: #f59e0b;
        width: 66%;
      }
      .strength-strong {
        background: #10b981;
        width: 100%;
      }
      .requirement {
        font-size: 0.875rem;
        color: #6b7280;
        display: flex;
        align-items: center;
        margin-top: 4px;
      }
      .requirement i {
        margin-right: 6px;
        font-size: 0.75rem;
      }
      .requirement.met {
        color: #10b981;
      }
      .requirement.met i {
        color: #10b981;
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen p-4">
    <div
      class="form-container bg-gray-200 rounded-3xl shadow-2xl max-w-md w-full p-8 md:p-12"
    >
      <!-- Icon and Title -->
      <div class="text-center mb-8">
        <div
          class="icon-container inline-flex items-center justify-center w-20 h-20 bg-indigo-100 rounded-full mb-4"
        >
          <i class="fas fa-key text-4xl text-indigo-600"></i>
        </div>
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Reset Password</h1>
        <p class="text-gray-600 font-medium mt-3">
          Create a strong password to secure your account.
        </p>
      </div>

      <!-- Error Message -->
      <div
        id="errorMessage"
        class="error-message mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg"
      >
        <i class="fas fa-exclamation-circle mr-2"></i>
        <span id="errorText"></span>
      </div>

      <!-- Success Message -->
      <div
        id="successMessage"
        class="success-message mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg"
      >
        <i class="fas fa-check-circle mr-2"></i>
        <span>Password reset successful! Redirecting to login...</span>
      </div>

      <!-- Server Message (EJS) -->
      <% if (typeof message !== 'undefined' && message) { %>
      <div
        class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-center font-medium"
      >
        <i class="fas fa-exclamation-circle mr-2"></i>
        <span><%= message %></span>
      </div>
      <% } %>

      <!-- Form -->
      <form
        id="resetPasswordForm"
        class="space-y-4"
        action="/reset-password"
        method="POST"
      >
        <!-- Hidden token field (populated from URL or server) -->
        <input type="hidden" name="email" value="<%= typeof email !== 'undefined' ? email : '' %>" />

        <!-- New Password Input -->
        <div>
          <div class="relative">
            <input
              type="password"
              id="newPassword"
              name="newPassword"
              placeholder="Enter New Password"
              class="input-field w-full px-6 py-4 bg-white rounded-2xl border-none outline-none text-gray-800 placeholder-gray-700 font-medium pr-12"
            />
            <i
              class="fas fa-eye password-toggle absolute right-5 top-1/2 transform -translate-y-1/2 text-gray-500"
              onclick="togglePassword('newPassword', this)"
            ></i>
          </div>
          
          <!-- Password Strength Meter -->
          <div class="strength-meter">
            <div id="strengthBar" class="strength-bar"></div>
          </div>
          <p id="strengthText" class="text-xs text-gray-600 mt-1 ml-2"></p>
          
          <p
            id="newPasswordError"
            class="error-message text-red-500 text-sm mt-2 ml-2"
          >
            <i class="fas fa-exclamation-circle mr-1"></i>
            <span></span>
          </p>
        </div>

        <!-- Password Requirements -->
        <div class="bg-white rounded-2xl p-4 space-y-1">
          <p class="text-sm font-semibold text-gray-700 mb-2">Password must contain:</p>
          <div class="requirement" id="req-length">
            <i class="fas fa-circle"></i>
            <span>At least 8 characters</span>
          </div>
          <div class="requirement" id="req-uppercase">
            <i class="fas fa-circle"></i>
            <span>One uppercase letter</span>
          </div>
          <div class="requirement" id="req-lowercase">
            <i class="fas fa-circle"></i>
            <span>One lowercase letter</span>
          </div>
          <div class="requirement" id="req-number">
            <i class="fas fa-circle"></i>
            <span>One number</span>
          </div>
        </div>

        <!-- Confirm Password Input -->
        <div>
          <div class="relative">
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm New Password"
              class="input-field w-full px-6 py-4 bg-white rounded-2xl border-none outline-none text-gray-800 placeholder-gray-700 font-medium pr-12"
            />
            <i
              class="fas fa-eye password-toggle absolute right-5 top-1/2 transform -translate-y-1/2 text-gray-500"
              onclick="togglePassword('confirmPassword', this)"
            ></i>
          </div>
          <p
            id="confirmPasswordError"
            class="error-message text-red-500 text-sm mt-2 ml-2"
          >
            <i class="fas fa-exclamation-circle mr-1"></i>
            <span></span>
          </p>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="submit-btn w-full bg-indigo-600 text-white font-bold text-xl py-4 rounded-2xl hover:bg-indigo-700 mt-6"
        >
          Reset Password
        </button>
      </form>

      <!-- Back to Login -->
      <div class="text-center mt-6">
        <p class="text-gray-700 font-medium">
          Remember your password?
          <a
            href="/login"
            class="text-indigo-600 hover:text-indigo-700 font-semibold hover:underline"
            >Log In</a
          >
        </p>
      </div>
    </div>

    <script>
      function togglePassword(fieldId, icon) {
        const field = document.getElementById(fieldId);
        const type = field.type === "password" ? "text" : "password";
        field.type = type;
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      }

      function showError(fieldId, message) {
        const errorElement = document.getElementById(fieldId + "Error");
        errorElement.querySelector("span").textContent = message;
        errorElement.style.display = "block";
        document
          .getElementById(fieldId)
          .classList.add("border-2", "border-red-500");
      }

      function hideError(fieldId) {
        const errorElement = document.getElementById(fieldId + "Error");
        errorElement.style.display = "none";
        document
          .getElementById(fieldId)
          .classList.remove("border-2", "border-red-500");
      }

      function hideAllErrors() {
        ["newPassword", "confirmPassword"].forEach((field) => hideError(field));
        document.getElementById("errorMessage").style.display = "none";
      }

      function showMainError(message) {
        const errorMessage = document.getElementById("errorMessage");
        document.getElementById("errorText").textContent = message;
        errorMessage.style.display = "block";
        setTimeout(() => {
          errorMessage.style.display = "none";
        }, 5000);
      }

      function checkPasswordStrength(password) {
        let strength = 0;
        const requirements = {
          length: password.length >= 8,
          uppercase: /[A-Z]/.test(password),
          lowercase: /[a-z]/.test(password),
          number: /[0-9]/.test(password),
        };

        // Update requirement indicators
        document.getElementById("req-length").classList.toggle("met", requirements.length);
        document.getElementById("req-uppercase").classList.toggle("met", requirements.uppercase);
        document.getElementById("req-lowercase").classList.toggle("met", requirements.lowercase);
        document.getElementById("req-number").classList.toggle("met", requirements.number);

        // Calculate strength
        Object.values(requirements).forEach((met) => {
          if (met) strength++;
        });

        // Update strength bar
        const strengthBar = document.getElementById("strengthBar");
        const strengthText = document.getElementById("strengthText");

        strengthBar.className = "strength-bar";
        if (strength === 0) {
          strengthBar.style.width = "0%";
          strengthText.textContent = "";
        } else if (strength <= 2) {
          strengthBar.classList.add("strength-weak");
          strengthText.textContent = "Weak password";
          strengthText.style.color = "#ef4444";
        } else if (strength === 3) {
          strengthBar.classList.add("strength-medium");
          strengthText.textContent = "Medium password";
          strengthText.style.color = "#f59e0b";
        } else {
          strengthBar.classList.add("strength-strong");
          strengthText.textContent = "Strong password";
          strengthText.style.color = "#10b981";
        }

        return requirements;
      }

      function validateNewPassword(password) {
        const requirements = checkPasswordStrength(password);

        if (!password) {
          showError("newPassword", "Password is required");
          return false;
        }

        if (!requirements.length) {
          showError("newPassword", "Password must be at least 8 characters");
          return false;
        }

        if (!requirements.uppercase || !requirements.lowercase || !requirements.number) {
          showError("newPassword", "Password must meet all requirements");
          return false;
        }

        hideError("newPassword");
        return true;
      }

      function validateConfirmPassword(password, confirmPassword) {
        if (!confirmPassword) {
          showError("confirmPassword", "Please confirm your password");
          return false;
        }

        if (password !== confirmPassword) {
          showError("confirmPassword", "Passwords do not match");
          return false;
        }

        hideError("confirmPassword");
        return true;
      }

      document.getElementById("newPassword").addEventListener("input", function () {
        checkPasswordStrength(this.value);
        if (this.value && this.classList.contains("border-red-500")) {
          hideError("newPassword");
        }
      });

      document.getElementById("newPassword").addEventListener("blur", function () {
        if (this.value) {
          validateNewPassword(this.value);
        }
      });

      document.getElementById("confirmPassword").addEventListener("input", function () {
        if (this.value && this.classList.contains("border-red-500")) {
          hideError("confirmPassword");
        }
      });

      document.getElementById("confirmPassword").addEventListener("blur", function () {
        const newPassword = document.getElementById("newPassword").value;
        if (this.value) {
          validateConfirmPassword(newPassword, this.value);
        }
      });

      document
        .getElementById("resetPasswordForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          hideAllErrors();

          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword = document.getElementById("confirmPassword").value;

          const isNewPasswordValid = validateNewPassword(newPassword);
          const isConfirmPasswordValid = validateConfirmPassword(
            newPassword,
            confirmPassword
          );

          if (!isNewPasswordValid || !isConfirmPasswordValid) {
            return;
          }

          // Show success message
          document.getElementById("successMessage").style.display = "block";

          // Redirect after 2 seconds (for demo)
          setTimeout(() => {
            window.location.href = "/login";
          }, 2000);

          // Uncomment below to actually submit the form
          this.submit();
        });

      document.querySelectorAll("input[type='password']").forEach((input) => {
        input.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            document
              .getElementById("resetPasswordForm")
              .dispatchEvent(new Event("submit"));
          }
        });
      });
    </script>
  </body>
</html>